---
import { getCollection, render } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import WelcomeBackground from '../../../components/welcome-background';
import Prose from '../../../components/Prose.astro';
import HeroCard from '../../../components/HeroCard.astro';
import BlogList from '../../../components/BlogList.astro';
import MobileSidebar from '../../../components/MobileSidebar.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id }, props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout>
  <div class="relative h-screen w-full" transition:name="bg-container" transition:animate="none">
    <WelcomeBackground client:load transition:persist="bg" />

    <div class="z-10 absolute inset-0 grid grid-cols-1 grid-rows-[1fr] md:grid-cols-[auto_1fr] md:grid-rows-2 gap-4 p-6 pt-16 md:pt-6">
      <!-- Sidebar: drawer on mobile, grid children on desktop -->
      <MobileSidebar>
        <div class="md:row-span-1 md:self-start">
          <HeroCard />
        </div>
        <div class="md:row-span-1 md:self-stretch">
          <BlogList compact activePostId={post.id} />
        </div>
      </MobileSidebar>

      <!-- Post content â€” full width on mobile, right side on desktop -->
      <div transition:name="post-content" class="md:row-span-2 overflow-y-auto bg-gray-800/90 p-8 rounded-lg min-h-0">
        <Prose>
          <Content />
        </Prose>
      </div>
    </div>
  </div>
</Layout>